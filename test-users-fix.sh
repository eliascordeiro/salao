#!/bin/bash

echo "ğŸ§ª Testando API de UsuÃ¡rios..."
echo ""
echo "Problema: Lista de usuÃ¡rios nÃ£o atualiza apÃ³s criar/editar"
echo "SoluÃ§Ã£o aplicada:"
echo "  1. âœ… API agora retorna { users: [...] } ao invÃ©s de array direto"
echo "  2. âœ… Adicionado cache: 'no-store' no fetch para forÃ§ar dados frescos"
echo "  3. âœ… Adicionado router.refresh() apÃ³s salvar"
echo "  4. âœ… Adicionado listener window 'focus' para recarregar"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“ Como testar:"
echo ""
echo "1. Acesse: http://localhost:3000/dashboard/usuarios"
echo "2. Clique em 'Novo UsuÃ¡rio'"
echo "3. Preencha o formulÃ¡rio e salve"
echo "4. Verifique se a lista atualiza automaticamente"
echo ""
echo "Se ainda nÃ£o funcionar:"
echo "  - Abra o DevTools (F12)"
echo "  - VÃ¡ em Console"
echo "  - Procure por erros em vermelho"
echo "  - Verifique a aba Network para ver a resposta da API"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ” Verificando servidor Next.js..."

if pgrep -f "next dev" > /dev/null; then
    echo "âœ… Servidor Next.js estÃ¡ rodando na porta 3000"
    echo ""
    echo "âš ï¸  IMPORTANTE: O Next.js usa cache agressivo!"
    echo "   Para ver as mudanÃ§as, faÃ§a:"
    echo "   1. Recarregue a pÃ¡gina com Ctrl+Shift+R (hard reload)"
    echo "   2. Ou feche e abra o navegador novamente"
    echo ""
else
    echo "âŒ Servidor Next.js nÃ£o estÃ¡ rodando!"
    echo "   Execute: npm run dev"
    echo ""
fi

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“Š UsuÃ¡rios atualmente no banco:"
echo ""

node check-users.js | grep -A 20 "LISTA DE USUÃRIOS"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ¨ CorreÃ§Ã£o aplicada com sucesso!"
echo ""
