#!/bin/bash

echo "üöÄ DEPLOY RAILWAY - Checklist de Atualiza√ß√£o"
echo "=============================================="
echo ""

echo "üìã MUDAN√áAS NESTE COMMIT:"
echo "  ‚úÖ Sess√£o de caixa autom√°tica quando agendamento COMPLETED"
echo "  ‚úÖ Campos de endere√ßo separados (street, number, complement, neighborhood)"
echo "  ‚úÖ Migration: 20251119130418_add_salon_address_fields"
echo "  ‚úÖ Remo√ß√£o da op√ß√£o 'Suporte' do Sidebar"
echo "  ‚úÖ Corre√ß√£o do bug de desfoco no campo CEP"
echo ""

echo "üóÑÔ∏è  BANCO DE DADOS:"
echo "  ‚ö†Ô∏è  Nova migration detectada!"
echo "  üì¶ Migration: add_salon_address_fields"
echo "  üìù Adiciona campos: street, number, complement, neighborhood ao modelo Salon"
echo ""

echo "üîß A√á√ïES NECESS√ÅRIAS NO RAILWAY:"
echo ""
echo "1Ô∏è‚É£  ATUALIZAR O C√ìDIGO (autom√°tico via GitHub):"
echo "   ‚úÖ Railway vai fazer pull do reposit√≥rio automaticamente"
echo "   ‚úÖ C√≥digo j√° foi commitado e enviado"
echo ""

echo "2Ô∏è‚É£  APLICAR MIGRATIONS (OBRIGAT√ìRIO):"
echo "   ‚ö†Ô∏è  Voc√™ DEVE rodar as migrations no Railway!"
echo ""
echo "   Op√ß√£o A - Via Railway CLI (mais f√°cil):"
echo "   $ railway run npx prisma migrate deploy"
echo ""
echo "   Op√ß√£o B - Via Dashboard do Railway:"
echo "   1. V√° em 'Deployments'"
echo "   2. Clique em 'New Deployment'"
echo "   3. Selecione 'Run Custom Command'"
echo "   4. Digite: npx prisma migrate deploy"
echo ""

echo "3Ô∏è‚É£  VERIFICAR VARI√ÅVEIS DE AMBIENTE (j√° devem estar ok):"
echo "   ‚úÖ DATABASE_URL (PostgreSQL)"
echo "   ‚úÖ NEXTAUTH_SECRET"
echo "   ‚úÖ NEXTAUTH_URL (https://seu-app.up.railway.app)"
echo "   ‚úÖ NODE_ENV=production"
echo "   ‚úÖ SMTP_* (email - se configurado)"
echo ""

echo "4Ô∏è‚É£  MIGRAR DADOS EXISTENTES (OPCIONAL):"
echo "   Se voc√™ tem agendamentos COMPLETED sem sess√£o de caixa:"
echo ""
echo "   Via Railway CLI:"
echo "   $ railway run node migrate-completed-to-cashier.js"
echo ""
echo "   ‚ö†Ô∏è  Isso criar√° sess√µes de caixa para agendamentos j√° conclu√≠dos"
echo ""

echo "üìä IMPACTO NO SISTEMA:"
echo "  ‚úÖ Baixo impacto - apenas adiciona colunas novas (nullable)"
echo "  ‚úÖ Dados existentes n√£o ser√£o perdidos"
echo "  ‚úÖ Sistema continua funcionando sem as migrations (mas sem novos recursos)"
echo ""

echo "üß™ TESTAR AP√ìS DEPLOY:"
echo "  1. Login no dashboard"
echo "  2. Ir em 'Meu Sal√£o' - verificar se campos de endere√ßo aparecem"
echo "  3. Ir em 'Agendamentos' - marcar um como 'Conclu√≠do'"
echo "  4. Ir em 'Caixa' - verificar se aparece sess√£o aberta"
echo ""

echo "üîó LINKS √öTEIS:"
echo "  Railway Dashboard: https://railway.app/dashboard"
echo "  Docs Prisma: https://www.prisma.io/docs/guides/migrate/production-migrations"
echo ""

echo "‚úÖ RESUMO:"
echo "  - C√≥digo: ‚úÖ J√° no GitHub"
echo "  - Railway: ‚ö†Ô∏è  Precisa rodar 'prisma migrate deploy'"
echo "  - .env: ‚úÖ Sem novas vari√°veis necess√°rias"
echo ""

echo "üí° COMANDO R√ÅPIDO PARA DEPLOY COMPLETO:"
echo "   $ railway run npx prisma migrate deploy && railway up"
echo ""
